#!/bin/sh

echo "-----Normalizing UFOs..."
psfnormalize -p checkfix=fix source/masters/Kedebideri-Regular.ufo
psfnormalize -p checkfix=fix source/masters/Kedebideri-Black.ufo

echo "-----Updating glyph orders in Regular..."
psfsetglyphorder -q --header sort_final -i source/glyph_data.csv source/masters/Kedebideri-Regular.ufo -p backup=False

echo "-----Updating production names in Regular..."
psfsetpsnames -p checkfix=fix -i source/glyph_data.csv source/masters/Kedebideri-Regular.ufo

echo
echo "Syncing glyph orders, psnames, and other metadata to other UFOs..."
psfsyncmasters -p scrlevel=w source/Kedebideri.designspace

echo "-----Rebuilding composites..."
psfbuildcomp -i source/composites.txt -c -n source/masters/Kedebideri-Regular.ufo -p backup=False
psfbuildcomp -i source/composites.txt -c -n source/masters/Kedebideri-Black.ufo -p backup=False

echo "Building internal fea..."
makefea -o source/masters/Kedebideri-Regular.ufo/features.fea -i source/opentype/main.feax source/masters/*-Regular.ufo &
makefea -o source/masters/Kedebideri-Black.ufo/features.fea -i source/opentype/main.feax source/masters/*-Black.ufo &

echo "-----Updating woff metadata file..."
psfmakewoffmetadata -q -n "Kedebideri" -i "org.sil.fonts" -o source/Kedebideri-WOFF-metadata.xml source/masters/Kedebideri-Regular.ufo

wait


echo "-----Preflight completed!"
